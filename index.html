<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Treino One UI</title>
    <meta name="theme-color" content="#121212">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="manifest" id="manifest-placeholder">

    <style>
        /* --- RESET & VARS --- */
        :root {
            --bg-color: #f8f9fa;
            --surface-color: #ffffff;
            --text-primary: #000000;
            --text-secondary: #747474;
            --accent-color: #3e82f7; /* Azul Samsung One UI */
            --accent-light: #e3f2fd;
            --border-radius: 26px;
            --card-radius: 20px;
            --spacing: 16px;
            --header-height: 60px;
            --nav-height: 70px;
            --font-stack: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        [data-theme="dark"] {
            --bg-color: #000000;
            --surface-color: #1c1c1c;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --accent-color: #5c9bff;
            --accent-light: #1e2a3b;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; padding: 0;
            font-family: var(--font-stack);
            background-color: var(--bg-color);
            color: var(--text-primary);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: background-color 0.3s, color 0.3s;
            user-select: none;
        }

        /* --- LAYOUT UTILS --- */
        .page {
            flex: 1;
            overflow-y: auto;
            padding: var(--spacing);
            padding-bottom: calc(var(--nav-height) + 20px);
            display: none;
            opacity: 0;
            transition: opacity 0.2s ease-in;
            padding-top: max(env(safe-area-inset-top), 20px);
        }
        .page.active { display: block; opacity: 1; }
        
        /* One UI Header Style */
        .header-large {
            padding: 40px 10px 20px 10px;
        }
        .header-large h1 {
            font-size: 32px;
            font-weight: 700;
            margin: 0;
            letter-spacing: -0.5px;
        }
        .header-large p {
            color: var(--text-secondary);
            margin: 5px 0 0 0;
            font-size: 16px;
        }

        /* --- COMPONENTS --- */
        .card {
            background-color: var(--surface-color);
            border-radius: var(--card-radius);
            padding: 20px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .btn {
            background-color: var(--accent-color);
            color: #fff;
            border: none;
            padding: 16px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            cursor: pointer;
            transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.98); }
        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--accent-color);
            color: var(--accent-color);
        }
        .btn-small { padding: 10px 20px; width: auto; font-size: 14px; }

        /* --- DAY SELECTION --- */
        .day-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }
        .day-card {
            background-color: var(--surface-color);
            padding: 24px;
            border-radius: var(--border-radius);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 18px;
            font-weight: 600;
        }
        .day-card span.id {
            background: var(--accent-light);
            color: var(--accent-color);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: 800;
        }
        .day-card-content { flex: 1; }
        
        /* --- EXERCISE LIST --- */
        .exercise-item {
            position: relative;
            padding-left: 10px;
        }
        .exercise-item.done h3 { text-decoration: line-through; color: var(--text-secondary); }
        .exercise-item h3 { margin: 0 0 5px 0; font-size: 18px; }
        .exercise-item .meta { color: var(--text-secondary); font-size: 14px; margin-bottom: 15px; }
        .exercise-actions { display: flex; gap: 10px; }
        
        /* --- TIMER OVERLAY --- */
        #timer-overlay {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            background: var(--surface-color);
            border-top-left-radius: 30px;
            border-top-right-radius: 30px;
            padding: 30px;
            box-shadow: 0 -5px 30px rgba(0,0,0,0.3);
            transform: translateY(110%);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1000;
            text-align: center;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        #timer-overlay.active { transform: translateY(0); }
        .timer-display { font-size: 64px; font-weight: 700; font-variant-numeric: tabular-nums; margin: 10px 0; display: block;}
        .timer-controls { display: flex; gap: 10px; justify-content: center; }

        /* --- BOTTOM NAV --- */
        .bottom-nav {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            height: var(--nav-height);
            background: var(--surface-color);
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-top: 1px solid rgba(0,0,0,0.05);
            padding-bottom: env(safe-area-inset-bottom);
            z-index: 900;
        }
        .nav-item {
            flex: 1;
            text-align: center;
            color: var(--text-secondary);
            font-size: 12px;
            padding: 10px;
        }
        .nav-item.active { color: var(--accent-color); font-weight: 600; }
        .nav-icon { font-size: 24px; display: block; margin-bottom: 4px; }

        /* --- STATS & SETTINGS --- */
        .stat-box {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .file-upload-wrapper {
            border: 2px dashed var(--text-secondary);
            border-radius: var(--card-radius);
            padding: 30px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
        }
        textarea.paste-area {
            width: 100%;
            background: var(--surface-color);
            color: var(--text-primary);
            border: 1px solid var(--text-secondary);
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 10px;
            min-height: 100px;
        }
        
        .empty-state {
            text-align: center;
            color: var(--text-secondary);
            margin-top: 50px;
        }
    </style>
</head>
<body>

    <div id="view-home" class="page active">
        <div class="header-large">
            <h1 id="greeting">Ol√°, Le!</h1>
            <p id="workout-title">Carregue seu treino para come√ßar</p>
        </div>
        
        <div id="days-container" class="day-grid">
            <div class="empty-state">
                <p>Nenhum treino carregado.</p>
                <p>V√° em ‚öôÔ∏è Ajustes para enviar o arquivo.</p>
            </div>
        </div>
    </div>

    <div id="view-workout" class="page">
        <div class="header-large" style="display: flex; align-items: center; gap: 15px;">
            <span onclick="navTo('home')" style="font-size: 24px; cursor:pointer;">&#8592;</span>
            <div>
                <h1 id="current-day-title">Treino A</h1>
                <p>Foco e for√ßa!</p>
            </div>
        </div>
        <div id="exercises-list">
            </div>
        <br><br>
    </div>

    <div id="view-stats" class="page">
        <div class="header-large">
            <h1>Progresso</h1>
            <p>Seu hist√≥rico de dedica√ß√£o</p>
        </div>
        
        <div class="card">
            <div class="stat-box"><span>Hoje:</span> <b id="stat-today">0</b></div>
            <div class="stat-box"><span>Esta Semana:</span> <b id="stat-week">0</b></div>
            <div class="stat-box"><span>Este M√™s:</span> <b id="stat-month">0</b></div>
            <hr style="border:0; border-top:1px solid var(--bg-color); margin: 15px 0;">
            <div style="font-size: 14px; color: var(--text-secondary);">
                Hist√≥rico recente:
                <ul id="history-list" style="padding-left: 20px;"></ul>
            </div>
        </div>
    </div>

    <div id="view-settings" class="page">
        <div class="header-large">
            <h1>Ajustes</h1>
            <p>Gerencie seu app</p>
        </div>

        <div class="card">
            <h3>Apar√™ncia</h3>
            <button class="btn btn-outline" onclick="toggleTheme()">Alternar Tema (Dark/Light)</button>
        </div>

        <div class="card">
            <h3>Carregar Treino (.txt)</h3>
            <p style="font-size:14px; color: var(--text-secondary);">Selecione o arquivo ou cole o texto.</p>
            
            <div class="file-upload-wrapper" onclick="document.getElementById('fileInput').click()">
                üìÅ Toque para selecionar arquivo
                <input type="file" id="fileInput" accept=".txt" style="display: none;" onchange="handleFileUpload(this)">
            </div>

            <p style="text-align:center; font-size:12px;">OU</p>
            
            <textarea id="pasteArea" class="paste-area" placeholder="Cole o conte√∫do do treino aqui..."></textarea>
            <button class="btn" onclick="handlePasteUpload()">Salvar Treino Colado</button>
        </div>

        <div class="card">
            <h3 style="color: #ff4d4d;">Zona de Perigo</h3>
            <button class="btn btn-outline" style="border-color: #ff4d4d; color: #ff4d4d;" onclick="clearAllData()">Resetar Tudo</button>
        </div>
        
        <div style="text-align: center; color: var(--text-secondary); margin-top: 30px; font-size: 12px;">
            Awadev Labs v1.0 ‚Ä¢ PWA Offline
        </div>
    </div>

    <div id="timer-overlay">
        <div style="font-size: 18px; color: var(--text-secondary);">Descansando...</div>
        <span id="timer-display" class="timer-display">00:00</span>
        <div class="timer-controls">
            <button class="btn btn-outline btn-small" onclick="addTime(10)">+10s</button>
            <button class="btn btn-outline btn-small" onclick="stopTimer()">Parar</button>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="navTo('home')" id="nav-home">
            <span class="nav-icon">üèãÔ∏è</span>Treino
        </div>
        <div class="nav-item" onclick="navTo('stats')" id="nav-stats">
            <span class="nav-icon">üìä</span>Progresso
        </div>
        <div class="nav-item" onclick="navTo('settings')" id="nav-settings">
            <span class="nav-icon">‚öôÔ∏è</span>Ajustes
        </div>
    </nav>

    <script>
        // --- 1. STATE & CONSTANTS ---
        const APP_KEY = 'iron_le_app_v1';
        const SETTINGS_KEY = 'iron_le_settings';
        const HISTORY_KEY = 'iron_le_history';

        let appState = {
            workout: null,
            activeDayId: null
        };
        
        let userHistory = []; // Array of {date: ISOString, dayId: 'A'}
        let timerInterval = null;
        let settings = { theme: 'dark' };

        // --- 2. INIT & PWA ---
        window.addEventListener('load', () => {
            loadData();
            applyTheme();
            setupPWA();
            renderHome();
            updateStats();
        });

        function setupPWA() {
            // Generate Manifest Inline
            const manifest = {
                name: "Iron Le Treino",
                short_name: "IronLe",
                start_url: ".",
                display: "standalone",
                background_color: "#000000",
                theme_color: "#000000",
                icons: [{
                    src: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><text y='1em' font-size='400'>üí™</text></svg>",
                    sizes: "192x192 512x512",
                    type: "image/svg+xml"
                }]
            };
            const stringManifest = JSON.stringify(manifest);
            const blob = new Blob([stringManifest], {type: 'application/json'});
            document.getElementById('manifest-placeholder').href = URL.createObjectURL(blob);

            // Register Service Worker Inline
            if ('serviceWorker' in navigator) {
                const swCode = `
                    self.addEventListener('install', e => self.skipWaiting());
                    self.addEventListener('activate', e => e.waitUntil(self.clients.claim()));
                    self.addEventListener('fetch', e => {
                        e.respondWith(
                            fetch(e.request).catch(() => caches.match(e.request))
                        );
                    });
                `;
                const swBlob = new Blob([swCode], {type: 'application/javascript'});
                navigator.serviceWorker.register(URL.createObjectURL(swBlob))
                    .then(() => console.log('SW Registered'))
                    .catch(err => console.log('SW Fail', err));
            }
        }

        // --- 3. DATA MANAGEMENT ---
        function loadData() {
            const savedWorkout = localStorage.getItem(APP_KEY);
            if (savedWorkout) appState.workout = JSON.parse(savedWorkout);
            
            const savedSettings = localStorage.getItem(SETTINGS_KEY);
            if (savedSettings) settings = JSON.parse(savedSettings);

            const savedHistory = localStorage.getItem(HISTORY_KEY);
            if (savedHistory) userHistory = JSON.parse(savedHistory);
        }

        function saveData() {
            if (appState.workout) localStorage.setItem(APP_KEY, JSON.stringify(appState.workout));
            localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
            localStorage.setItem(HISTORY_KEY, JSON.stringify(userHistory));
        }

        function clearAllData() {
            if(confirm('Tem certeza? Isso apagar√° seu treino e hist√≥rico.')) {
                localStorage.clear();
                location.reload();
            }
        }

        // --- 4. PARSER (TXT to JSON) ---
        function parseWorkoutTXT(text) {
            const lines = text.split('\n');
            let workout = { title: 'Meu Treino', days: [] };
            let currentDay = null;

            lines.forEach(line => {
                line = line.trim();
                if (!line) return;

                if (line.startsWith('# ')) {
                    workout.title = line.replace('# ', '').trim();
                } else if (line.startsWith('## ')) {
                    const dayParts = line.replace('## ', '').split('-');
                    currentDay = {
                        id: dayParts[0].trim(),
                        name: dayParts[1] ? dayParts[1].trim() : dayParts[0].trim(),
                        exercises: []
                    };
                    workout.days.push(currentDay);
                } else if (currentDay && !line.startsWith('#')) {
                    // Exercise format: Name | Sets | Rest
                    const parts = line.split('|');
                    if (parts.length >= 2) {
                        currentDay.exercises.push({
                            name: parts[0].trim(),
                            sets: parts[1].trim(),
                            rest: parts[2] ? parseInt(parts[2].trim()) : 60,
                            done: false // Daily state
                        });
                    }
                }
            });
            return workout;
        }

        function handleFileUpload(input) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                processNewWorkout(e.target.result);
            };
            reader.readAsText(file);
        }

        function handlePasteUpload() {
            const text = document.getElementById('pasteArea').value;
            if(text) processNewWorkout(text);
        }

        function processNewWorkout(text) {
            try {
                const parsed = parseWorkoutTXT(text);
                if (parsed.days.length === 0) throw new Error("Formato inv√°lido");
                appState.workout = parsed;
                saveData();
                alert('Treino carregado com sucesso!');
                navTo('home');
                renderHome();
            } catch (e) {
                alert('Erro ao ler arquivo. Verifique o formato.');
            }
        }

        // --- 5. RENDERERS ---
        function navTo(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            
            // Show target
            if (pageId === 'home') document.getElementById('view-home').classList.add('active');
            if (pageId === 'workout') document.getElementById('view-workout').classList.add('active');
            if (pageId === 'stats') {
                document.getElementById('view-stats').classList.add('active');
                updateStats();
            }
            if (pageId === 'settings') document.getElementById('view-settings').classList.add('active');

            // Nav Highlight
            const navId = pageId === 'workout' ? 'nav-home' : `nav-${pageId}`;
            const navEl = document.getElementById(navId);
            if(navEl) navEl.classList.add('active');
        }

        function renderHome() {
            const container = document.getElementById('days-container');
            const titleEl = document.getElementById('workout-title');
            
            if (!appState.workout) return;

            titleEl.textContent = appState.workout.title;
            container.innerHTML = '';

            appState.workout.days.forEach(day => {
                const div = document.createElement('div');
                div.className = 'day-card';
                div.onclick = () => openDay(day.id);
                div.innerHTML = `
                    <span class="id">${day.id}</span>
                    <div class="day-card-content">${day.name}</div>
                    <span style="color:var(--text-secondary)">&#10095;</span>
                `;
                container.appendChild(div);
            });
        }

        function openDay(dayId) {
            appState.activeDayId = dayId;
            const day = appState.workout.days.find(d => d.id === dayId);
            if (!day) return;

            document.getElementById('current-day-title').textContent = `${day.id} - ${day.name}`;
            
            // Render Exercises
            const list = document.getElementById('exercises-list');
            list.innerHTML = '';
            
            day.exercises.forEach((ex, index) => {
                const el = document.createElement('div');
                el.className = `card exercise-item ${ex.done ? 'done' : ''}`;
                el.innerHTML = `
                    <h3>${ex.name}</h3>
                    <div class="meta">${ex.sets} ‚Ä¢ Descanso: ${ex.rest}s</div>
                    <div class="exercise-actions">
                        <button class="btn btn-outline btn-small" onclick="startRest(${ex.rest})">‚è≥ Descanso</button>
                        <button class="btn btn-small" onclick="toggleDone('${dayId}', ${index})">
                            ${ex.done ? 'Desfazer' : '‚úÖ Feito'}
                        </button>
                    </div>
                `;
                list.appendChild(el);
            });

            navTo('workout');
        }

        function toggleDone(dayId, exIndex) {
            const day = appState.workout.days.find(d => d.id === dayId);
            day.exercises[exIndex].done = !day.exercises[exIndex].done;
            saveData();
            
            // Check if all done to log history
            const allDone = day.exercises.every(e => e.done);
            if (allDone && day.exercises[exIndex].done) {
                logHistory(dayId);
            }
            
            openDay(dayId); // Re-render
        }

        // --- 6. LOGIC: TIMER & HISTORY ---
        function startRest(seconds) {
            const overlay = document.getElementById('timer-overlay');
            const display = document.getElementById('timer-display');
            let remaining = seconds;
            
            overlay.classList.add('active');
            display.textContent = formatTime(remaining);
            
            if(timerInterval) clearInterval(timerInterval);

            timerInterval = setInterval(() => {
                remaining--;
                display.textContent = formatTime(remaining);
                if (remaining <= 0) {
                    stopTimer();
                    finishRest();
                }
            }, 1000);
        }

        function addTime(sec) {
            const display = document.getElementById('timer-display');
            let current = display.textContent.split(':');
            let remaining = parseInt(current[0])*60 + parseInt(current[1]);
            remaining += sec;
            display.textContent = formatTime(remaining);
            // Need to update interval logic slightly or just let next tick handle, 
            // but for simplicity, we rely on the display update and restart interval logic if needed.
            // Actually, simpler to just restart interval with new time, but let's keep it visual for now.
            // Correct way: store 'endTime' timestamp. But for simple app, decrementing is fine.
        }

        function stopTimer() {
            clearInterval(timerInterval);
            document.getElementById('timer-overlay').classList.remove('active');
        }

        function finishRest() {
            if ("vibrate" in navigator) navigator.vibrate([200, 100, 200]);
            // Optional: play sound
            alert("Descanso finalizado!");
        }

        function formatTime(sec) {
            const m = Math.floor(sec / 60).toString().padStart(2, '0');
            const s = (sec % 60).toString().padStart(2, '0');
            return `${m}:${s}`;
        }

        // --- 7. STATS & THEME ---
        function logHistory(dayId) {
            const today = new Date().toISOString().split('T')[0];
            // Check if already logged today for this specific day ID to avoid duplicates
            const alreadyLogged = userHistory.some(h => h.date === today && h.dayId === dayId);
            
            if (!alreadyLogged) {
                userHistory.unshift({ date: today, dayId: dayId });
                saveData();
                
                // Confetti or congrats could go here
                if ("vibrate" in navigator) navigator.vibrate(500);
            }
        }

        function updateStats() {
            const now = new Date();
            const todayStr = now.toISOString().split('T')[0];
            
            // Filter helpers
            const isSameWeek = (d1, d2) => {
                const startOfWeek = d => {
                    const date = new Date(d);
                    const day = date.getDay(); 
                    const diff = date.getDate() - day + (day == 0 ? -6:1); 
                    return new Date(date.setDate(diff));
                }
                return startOfWeek(d1).getTime() === startOfWeek(d2).getTime();
            };

            const countToday = userHistory.filter(h => h.date === todayStr).length;
            const countWeek = userHistory.filter(h => isSameWeek(new Date(h.date), now)).length;
            const countMonth = userHistory.filter(h => h.date.startsWith(todayStr.substring(0, 7))).length;

            document.getElementById('stat-today').textContent = countToday;
            document.getElementById('stat-week').textContent = countWeek;
            document.getElementById('stat-month').textContent = countMonth;

            // List
            const listEl = document.getElementById('history-list');
            listEl.innerHTML = '';
            userHistory.slice(0, 5).forEach(h => {
                const li = document.createElement('li');
                const [y,m,d] = h.date.split('-');
                li.textContent = `${d}/${m} - Treino ${h.dayId}`;
                listEl.appendChild(li);
            });
        }

        function toggleTheme() {
            settings.theme = settings.theme === 'dark' ? 'light' : 'dark';
            saveData();
            applyTheme();
        }

        function applyTheme() {
            document.documentElement.setAttribute('data-theme', settings.theme);
            const color = settings.theme === 'dark' ? '#000000' : '#f8f9fa';
            document.querySelector('meta[name="theme-color"]').setAttribute('content', color);
        }
    </script>
</body>
</html>